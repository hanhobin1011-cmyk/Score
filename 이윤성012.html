<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>이윤성 학생 주간 리포트</title>
    <!-- Google Fonts: Noto Sans KR -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <style>
        /* [테마 설정] */
        :root {
            --bg-color: #020204;
            --card-bg: #111115;
            --text-main: #f8fafc;
            --text-sub: #94a3b8;
            
            /* 과목별 포인트 컬러 */
            --accent-blue: #3b82f6;   /* 대수 (Zap) */
            --accent-violet: #8b5cf6; /* 미적분 (Sparkles) */
            --accent-rose: #f43f5e;   /* 담금질 (Target) */
            --accent-green: #10b981;  /* 계획 */
            --accent-gold: #fbbf24;   /* 로그 */

            /* 신호등 상태 컬러 */
            --status-blue: #3b82f6;   /* 우수 */
            --status-orange: #f97316; /* 보통 */
            --status-red: #ef4444;    /* 위험 */
            --status-black: #0f172a;  /* 심각 */
            
            --timeline-line: rgba(255, 255, 255, 0.1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            padding-bottom: 60px;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
        }

        /* 배경 노이즈 효과 */
        .noise-overlay {
            position: fixed; inset: 0; pointer-events: none; opacity: 0.03;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
            z-index: -1;
        }

        /* [헤더] */
        header {
            position: sticky;
            top: 0;
            background: rgba(2, 2, 4, 0.85);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255,255,255,0.08);
            z-index: 100;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .brand { font-size: 16px; font-weight: 900; letter-spacing: -0.5px; color: white; font-style: italic; }
        .brand span { color: var(--accent-blue); }
        .sub-brand { font-size: 10px; color: var(--text-sub); display: block; letter-spacing: 2px; margin-bottom: 2px; font-weight: 700; }
        .user-avatar {
            width: 32px; height: 32px;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: 700; font-size: 13px; color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        /* [메인] */
        main { max-width: 500px; margin: 0 auto; padding: 20px; opacity: 0; animation: slideUp 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }

        /* [프로필] */
        .profile-sec { margin-top: 10px; margin-bottom: 25px; }
        .student-name { font-size: 28px; font-weight: 900; line-height: 1.2; color: white; display: flex; align-items: center; gap: 8px; letter-spacing: -0.02em; }
        .school-badge { font-size: 12px; font-weight: 700; color: #fff; background: rgba(255,255,255,0.1); padding: 4px 8px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.1); }
        .date-info { font-size: 13px; color: var(--text-sub); margin-top: 6px; display: flex; align-items: center; gap: 6px; font-weight: 300; }
        .date-badge { background: rgba(59, 130, 246, 0.1); color: #60a5fa; border: 1px solid rgba(59, 130, 246, 0.2); padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 700; }

        /* [신호등 상태창] */
        .status-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 30px; }
        .status-item {
            background: var(--card-bg); border-radius: 16px; padding: 15px 10px;
            display: flex; flex-direction: column; align-items: center; gap: 8px;
            border: 1px solid rgba(255,255,255,0.05); text-align: center;
            transition: transform 0.2s;
        }
        .status-item:active { transform: scale(0.98); }
        
        .status-icon-wrap {
            width: 32px; height: 32px; border-radius: 10px; display: flex; align-items: center; justify-content: center;
            margin-bottom: 2px;
        }
        .status-icon-wrap svg { width: 18px; height: 18px; stroke-width: 2.5; }

        /* 상태별 색상 */
        .st-blue .status-icon-wrap { background: rgba(59, 130, 246, 0.15); color: #60a5fa; box-shadow: 0 0 15px rgba(59, 130, 246, 0.15); }
        .st-violet .status-icon-wrap { background: rgba(139, 92, 246, 0.15); color: #a78bfa; box-shadow: 0 0 15px rgba(139, 92, 246, 0.15); }
        .st-rose .status-icon-wrap { background: rgba(244, 63, 94, 0.15); color: #fb7185; box-shadow: 0 0 15px rgba(244, 63, 94, 0.15); }
        .st-black .status-icon-wrap { background: rgba(255, 255, 255, 0.05); color: #94a3b8; border: 1px solid rgba(255,255,255,0.1); }

        /* 신호등 점 */
        .traffic-dot { width: 8px; height: 8px; border-radius: 50%; margin-top: 4px; }
        .dot-blue { background: var(--status-blue); box-shadow: 0 0 8px var(--status-blue); }
        .dot-orange { background: var(--status-orange); box-shadow: 0 0 8px var(--status-orange); }
        .dot-red { background: var(--status-red); box-shadow: 0 0 8px var(--status-red); }
        .dot-black { background: #94a3b8; border: 2px solid #fff; box-shadow: 0 0 8px #fff; }

        .status-subject { font-size: 12px; color: var(--text-sub); font-weight: 600; }
        .status-label { font-size: 11px; color: white; font-weight: 800; letter-spacing: -0.3px; }

        /* [카드 공통] */
        .card {
            background: var(--card-bg); border-radius: 20px; padding: 24px; margin-bottom: 24px;
            border: 1px solid rgba(255,255,255,0.05);
            box-shadow: 0 10px 30px -10px rgba(0,0,0,0.5);
            position: relative; overflow: hidden;
        }
        .card::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        }

        .card-header { display: flex; align-items: center; gap: 10px; margin-bottom: 20px; }
        .card-icon-box { 
            width: 32px; height: 32px; border-radius: 10px; 
            display: flex; align-items: center; justify-content: center;
            background: rgba(255,255,255,0.05); color: white;
        }
        .card-icon-box svg { width: 18px; height: 18px; stroke-width: 2.5; }
        .card-title { font-size: 16px; font-weight: 800; color: #f1f5f9; letter-spacing: -0.02em; }

        /* [타임라인] */
        .timeline { padding-left: 6px; }
        .timeline-item { position: relative; padding-left: 28px; margin-bottom: 20px; border-left: 2px solid var(--timeline-line); }
        .timeline-item:last-child { margin-bottom: 0; border-left-color: transparent; }
        .timeline-dot { 
            position: absolute; left: -6px; top: 2px; width: 10px; height: 10px; border-radius: 50%; 
            background: var(--bg-color); border: 2px solid var(--text-sub);
            transition: all 0.3s;
        }
        .log-date { font-size: 11px; font-weight: 800; margin-bottom: 4px; letter-spacing: 0.5px; }
        .log-title { font-size: 14px; color: white; font-weight: 700; margin-bottom: 2px; }
        .log-desc { font-size: 13px; color: #94a3b8; line-height: 1.5; font-weight: 300; }

        /* [그래프] */
        .chart-wrap { height: 220px; display: flex; justify-content: center; align-items: flex-end; padding-bottom: 10px; }

        /* [시험 상세] */
        .test-card { border-left: 3px solid transparent; background: #15151a; }
        .test-card.blue { border-color: var(--accent-blue); }
        .test-card.violet { border-color: var(--accent-violet); }
        .test-card.rose { border-color: var(--accent-rose); }
        .test-card.orange { border-color: var(--status-orange); } 
        .test-card.red { border-color: var(--status-red); }

        .test-top { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; }
        .test-info-group { display: flex; flex-direction: column; gap: 2px; }
        .test-name { font-size: 15px; font-weight: 800; color: white; display: flex; align-items: center; gap: 6px; }
        .test-sub { font-size: 11px; color: #64748b; font-weight: 500; }
        .test-rank { 
            font-size: 11px; color: #94a3b8; background: rgba(255,255,255,0.05); 
            padding: 4px 8px; border-radius: 6px; display: inline-block; margin-top: 4px; 
            font-family: 'Roboto Mono', monospace;
        }
        .test-score { font-size: 26px; font-weight: 900; font-family: 'Roboto Mono', monospace; letter-spacing: -1px; }
        
        .blue .test-score { color: #60a5fa; text-shadow: 0 0 20px rgba(59, 130, 246, 0.2); }
        .violet .test-score { color: #a78bfa; text-shadow: 0 0 20px rgba(139, 92, 246, 0.2); }
        .rose .test-score { color: #fb7185; text-shadow: 0 0 20px rgba(244, 63, 94, 0.2); }
        .orange .test-score { color: #fb923c; }
        .red .test-score { color: #f87171; }

        .tag-box { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 14px; }
        .tag { font-size: 11px; padding: 4px 10px; border-radius: 6px; background: rgba(255,255,255,0.03); color: #cbd5e1; border: 1px solid rgba(255,255,255,0.08); }
        .warning-tag { color: #f87171; border-color: rgba(248, 113, 113, 0.3); background: rgba(248, 113, 113, 0.1); font-weight: 700; display: flex; align-items: center; gap: 4px; }
        .check-tag { color: #fb923c; border-color: rgba(251, 146, 60, 0.3); background: rgba(251, 146, 60, 0.1); font-weight: 600; display: flex; align-items: center; gap: 4px; }
        .review-tag { color: #a78bfa; border-color: rgba(167, 139, 250, 0.3); background: rgba(167, 139, 250, 0.1); font-weight: 600; display: flex; align-items: center; gap: 4px; }
        
        /* 상세 보기 버튼 */
        .detail-btn { width: 100%; padding: 12px; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08); border-radius: 12px; color: #94a3b8; font-size: 12px; font-weight: 600; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .detail-btn:hover { background: rgba(255,255,255,0.08); color: white; }
        .detail-btn svg { width: 14px; height: 14px; }

        /* [다음주 계획] */
        .plan-list { display: flex; flex-direction: column; gap: 10px; }
        .plan-item { 
            background: rgba(255,255,255,0.02); border-radius: 12px; padding: 14px; 
            border-left: 3px solid #6b7280; display: flex; flex-direction: column; gap: 4px;
        }
        .plan-header { display: flex; align-items: center; gap: 8px; }
        .plan-subj { font-size: 11px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px; }
        .plan-title { font-size: 13px; font-weight: 700; color: white; }
        .plan-desc { font-size: 12px; color: #94a3b8; margin-top: 2px; }

        /* [코멘트] */
        .comment-box { background: rgba(139, 92, 246, 0.05); border: 1px solid rgba(139, 92, 246, 0.1); border-radius: 16px; padding: 20px; font-size: 14px; line-height: 1.7; color: #e2e8f0; white-space: pre-line; }
        .comment-box strong { color: #a78bfa; font-weight: 700; }

        /* [모달] */
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(5px); z-index: 1000; align-items: center; justify-content: center; padding: 20px; opacity: 0; transition: opacity 0.3s; }
        .modal-overlay.active { display: flex; opacity: 1; }
        .modal-content { background: #15151a; width: 100%; max-width: 500px; max-height: 80vh; border-radius: 24px; overflow: hidden; display: flex; flex-direction: column; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5); transform: translateY(20px); transition: transform 0.3s; }
        .modal-overlay.active .modal-content { transform: translateY(0); }
        .modal-header { padding: 20px 24px; border-bottom: 1px solid rgba(255,255,255,0.05); display: flex; justify-content: space-between; align-items: center; background: #1a1b20; }
        .modal-title { font-size: 16px; font-weight: 800; color: white; }
        .close-btn { background: none; border: none; color: #64748b; font-size: 24px; cursor: pointer; padding: 4px; transition: color 0.2s; }
        .close-btn:hover { color: white; }
        .modal-body { padding: 0; overflow-y: auto; }
        
        .detail-table { width: 100%; border-collapse: collapse; font-size: 13px; }
        .detail-table th { background: rgba(255,255,255,0.02); color: #64748b; font-weight: 700; text-align: left; padding: 14px 20px; border-bottom: 1px solid rgba(255,255,255,0.05); position: sticky; top: 0; backdrop-filter: blur(10px); z-index: 10; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; }
        .detail-table td { padding: 14px 20px; border-bottom: 1px solid rgba(255,255,255,0.03); color: #cbd5e1; }
        .q-num { font-weight: 700; color: #fff; font-family: 'Roboto Mono', monospace; }
        .q-badge { padding: 3px 8px; border-radius: 4px; font-size: 10px; font-weight: 800; }
        .diff-high { color: #f87171; background: rgba(248, 113, 113, 0.1); }
        .diff-mid { color: #fb923c; background: rgba(251, 146, 60, 0.1); }
        .diff-low { color: #60a5fa; background: rgba(96, 165, 250, 0.1); }
        .res-o { color: #3b82f6; font-weight: 800; }
        .res-x { color: #ef4444; font-weight: 800; }
        .res-check { color: #fb923c; font-weight: 800; }
        .res-review { color: #a78bfa; font-weight: 800; }

        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        footer { text-align: center; font-size: 11px; color: #475569; margin-top: 50px; font-weight: 500; letter-spacing: 0.5px; }
    </style>
</head>
<body>
    <div class="noise-overlay"></div>

    <header>
        <div>
            <span class="sub-brand">WEEKLY REPORT</span>
            <div class="brand">한호빈 수학 <span>& 우독학원</span></div>
        </div>
        <div class="user-avatar" id="avatar">이</div>
    </header>

    <main>
        <!-- 프로필 -->
        <section class="profile-sec">
            <h1 class="student-name" id="studentName"></h1>
            <div class="date-info">
                <span class="date-badge">1월 2주차</span>
                <span>학습 성취도 분석</span>
            </div>
        </section>

        <!-- 신호등 상태창 -->
        <div class="status-grid" id="statusGrid"></div>

        <!-- 1. 주간 수업 로그 -->
        <section class="card">
            <div class="card-header">
                <div class="card-icon-box" style="color:var(--accent-gold); background:rgba(251, 191, 36, 0.1);">
                    <!-- Calendar Icon -->
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                </div>
                <div class="card-title">Weekly Class Log</div>
            </div>
            <div class="timeline" id="logContainer"></div>
        </section>

        <!-- 2. 성취 그래프 -->
        <section class="card">
            <div class="card-header">
                <div class="card-icon-box" style="color:var(--accent-rose); background:rgba(244, 63, 94, 0.1);">
                    <!-- Chart Icon -->
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg>
                </div>
                <div class="card-title">성취도 그래프</div>
            </div>
            <div class="chart-wrap">
                <canvas id="barCanvas" width="300" height="200"></canvas>
            </div>
        </section>

        <!-- 3. 시험 상세 -->
        <div id="testContainer"></div>

        <!-- 4. 다음 주 계획 -->
        <section class="card">
            <div class="card-header">
                <div class="card-icon-box" style="color:var(--accent-green); background:rgba(16, 185, 129, 0.1);">
                    <!-- MapPin Icon -->
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                </div>
                <div class="card-title">Next Week Plan</div>
            </div>
            <div class="plan-list" id="planContainer"></div>
        </section>

        <!-- 5. 강사 코멘트 -->
        <section class="card" style="border-left: 3px solid var(--accent-violet);">
            <div class="card-header">
                <div class="card-icon-box" style="color:var(--accent-violet); background:rgba(139, 92, 246, 0.1);">
                    <!-- Message Icon -->
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg>
                </div>
                <div class="card-title">Teacher's Comment</div>
            </div>
            <div class="comment-box" id="commentBox"></div>
        </section>

        <footer>© Han Hobin Math & Udok Academy</footer>
    </main>

    <!-- 모달창 -->
    <div class="modal-overlay" id="detailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">분석 상세</h3>
                <button class="close-btn" onclick="closeModal()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <script>
        // ============================================================
        // [1. 학생 데이터 (이윤성)]
        // ============================================================
        const studentData = {
            name: "이윤성",
            school: "마전고",
            scores: {
                algebra:  { score: 93.8, totalQ: 16, wrong: 1 },
                calculus: { score: 71.4, totalQ: 14, wrong: 4 },
                mock:     { score: 55.6, totalQ: 18, wrong: 8 } 
            },
            ranks: {
                algebra:  { rank: 3, total: 15 },
                calculus: { rank: 11, total: 15 },
                mock:     { rank: 6, total: 9 }
            },
            incorrects: {
                // 오답 상태 코드: C(스스로 고침), D(해설 참고), X(오답), T(시간 부족)
                // 대수: 12번(D)
                algebra:  { 12: 'D' }, 
                // 미적분: 2번(D), 6번(C), 10번(C), 13번(C) -> 실제 감점은 되지만 긍정적
                calculus: { 2: 'D', 6: 'C', 10: 'C', 13: 'C' },
                // 담금질: 9(C), 10(D), 11(D), 13(D), 14(C), 16(D), 17(D), 18(C)
                mock:     { 9: 'C', 10: 'D', 11: 'D', 13: 'D', 14: 'C', 16: 'D', 17: 'D', 18: 'C' }
            },
            logs: [
                { date: "01/05(월)", subject: "미적분", title: "함수의 극한", desc: "함수의 극한 개념 학습", type: "calculus" },
                { date: "01/06(화)", subject: "대수", title: "지수", desc: "지수 개념 & 유형 학습", type: "algebra" },
                { date: "01/07(수)", subject: "미적분", title: "극한 & 연속", desc: "극한 유형 & 연속 개념 학습", type: "calculus" },
                { date: "01/08(목)", subject: "대수", title: "로그", desc: "로그 개념 & 유형 학습", type: "algebra" }
            ],
            plans: [
                { subj: "대수", title: "지수함수와 로그함수", desc: "함수의 그래프와 성질", color: "#3b82f6" },
                { subj: "미적분", title: "미분계수와 도함수", desc: "미분가능성과 도함수의 정의", color: "#8b5cf6" },
                { subj: "미적분", title: "도함수의 활용", desc: "접선의 방정식과 평균변화율", color: "#8b5cf6" }
            ],
            comment: `윤성 학생은 **대수 TEST(93.8점)**에서 12번(지수 로그 혼합) 한 문제만 해설을 참고(D)했고, 나머지는 완벽하게 해결하며 매우 우수한 성취를 보였습니다.

            **미적분(71.4점)**의 경우 점수만 보면 중위권 같지만, 내용을 보면 긍정적입니다. 틀린 4문제 중 3문제(6, 10, 13번)가 **'스스로 고침(C)'**입니다. 이는 개념은 이해하고 있으나 문제 풀이 과정에서 실수가 있었음을 의미하므로, 조금만 다듬으면 바로 상위권 도약이 가능합니다.

            **담금질(55.6점)**에서는 후반부 고난도 문항(10, 11, 13, 16, 17번)에서 해설 참고(D)가 많았습니다. 고1 과정의 심화 유형에 대한 적응력을 높이는 훈련이 필요해 보입니다.

            다음 주에는 **[지수/로그함수]**와 **[미분계수]** 진도를 나가며, 윤성 학생이 가진 '스스로 고치는 힘'을 '처음부터 맞히는 실력'으로 연결할 수 있도록 지도하겠습니다.`
        };

        // ============================================================
        // [2. 시험 메타 데이터]
        // ============================================================
        const testMeta = {
            algebra: { 
                title: "대수 TEST", sub: "지수의 확장 ~ 상용로그", 
                icon: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><polyline points="18 4 6 4 10 12 6 20 18 20"></polyline></svg>`
            },
            calculus: { 
                title: "미적분 TEST", sub: "함수의 극한", 
                icon: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M12 12c-2-2.67-4-4-6-4a4 4 0 1 0 0 8c2 0 4-1.33 6-4Zm0 0c2 2.67 4 4 6 4a4 4 0 1 0 0-8c-2 0-4 1.33-6 4Z"></path></svg>`
            },
            mock: { 
                title: "담금질 5회", sub: "고1 전범위 (3월 모의 대비)", 
                icon: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="M12 11h4"/><path d="M12 16h4"/><path d="M8 11h.01"/><path d="M8 16h.01"/></svg>`
            }
        };

        // 제공된 CSV 데이터를 기반으로 매핑
        const detailData = {
            algebra: [
                {q:1, diff:"중", concept:"지수법칙 묶음/약분"},
                {q:2, diff:"하", concept:"거듭제곱근 대소비교"},
                {q:3, diff:"중", concept:"소인수분해와 지수"},
                {q:4, diff:"중", concept:"합차공식/거듭제곱근"},
                {q:5, diff:"중", concept:"곱셈공식 변형"},
                {q:6, diff:"상", concept:"지수 등식 변형"},
                {q:7, diff:"하", concept:"로그 정의/변환"},
                {q:8, diff:"상", concept:"로그 성질과 이차식"},
                {q:9, diff:"상", concept:"밑변환과 근계수"},
                {q:10, diff:"중", concept:"밑변환 문자 표현"},
                {q:11, diff:"상", concept:"로그 성질 심화"},
                {q:12, diff:"상", concept:"지수/로그 혼합"},
                {q:13, diff:"중", concept:"정수/소수 부분"},
                {q:14, diff:"상", concept:"로그 자연수 조건"},
                {q:15, diff:"하", concept:"상용로그표"},
                {q:16, diff:"중", concept:"상용로그 실생활"}
            ],
            calculus: [
                {q:1, diff:"하", concept:"함수의 극한값"},
                {q:2, diff:"중", concept:"좌극한/우극한 비교"},
                {q:3, diff:"중", concept:"구간별 함수 극한"},
                {q:4, diff:"중", concept:"0/0꼴 유리식"},
                {q:5, diff:"상", concept:"합성함수 극한 해석"},
                {q:6, diff:"중", concept:"극한과 인수정리"},
                {q:7, diff:"중", concept:"극한의 성질/변형"},
                {q:8, diff:"상", concept:"0/0꼴 무리식"},
                {q:9, diff:"중", concept:"무한대 진위판별"},
                {q:10, diff:"상", concept:"음의 무한대 치환"},
                {q:11, diff:"중", concept:"0/0꼴 유리화/약분"},
                {q:12, diff:"하", concept:"미정계수 결정"},
                {q:13, diff:"상", concept:"다항함수 추론"},
                {q:14, diff:"중", concept:"샌드위치 정리"}
            ],
            mock: [
                {q:1, diff:"하", concept:"연립부등식 해"},
                {q:2, diff:"하", concept:"유리함수 그래프"},
                {q:3, diff:"중", concept:"두 직선의 교점"},
                {q:4, diff:"하", concept:"삼차방정식 허근"},
                {q:5, diff:"중", concept:"집합 연산(드모르간)"},
                {q:6, diff:"중", concept:"역함수 존재 조건"},
                {q:7, diff:"중", concept:"원과 직선/현의 길이"},
                {q:8, diff:"상", concept:"무리함수와 닮음비"},
                {q:9, diff:"상", concept:"이차방정식 켤레근"},
                {q:10, diff:"상", concept:"도형 내 사각형 닮음"},
                {q:11, diff:"상", concept:"유리함수 대칭성"},
                {q:12, diff:"상", concept:"순열과 조합(이웃X)"},
                {q:13, diff:"상", concept:"원/직선 접합/내분점"},
                {q:14, diff:"최상", concept:"합성함수 부등식"},
                {q:15, diff:"중", concept:"도형 평행이동"},
                {q:16, diff:"중", concept:"명제/충분/필요조건"},
                {q:17, diff:"최상", concept:"함수 개수(역함수X)"},
                {q:18, diff:"상", concept:"집합 약수/배수 관계"}
            ]
        };

        // ============================================================
        // [로직 구현]
        // ============================================================
        
        function getMockStatus(wrongCnt, score) {
            if (wrongCnt <= 2) return { color: "dot-blue", label: "심화 우수", styleClass: "st-blue", textClass: "blue" };
            if (wrongCnt <= 5) return { color: "dot-orange", label: "심화 훈련 필요", styleClass: "st-orange", textClass: "orange" };
            if (wrongCnt <= 9) return { color: "dot-red", label: "심화 보완 필요", styleClass: "st-rose", textClass: "red" };
            return { color: "dot-black", label: "복습 시급", styleClass: "st-black", textClass: "black" };
        }
        function getNormalStatus(score, wrongCnt) {
            if (score >= 90) return { color: "dot-blue", label: "최상위권", styleClass: "st-blue", textClass: "blue" };
            if (score >= 80) return { color: "dot-orange", label: "주의 요망", styleClass: "st-orange", textClass: "orange" };
            if (wrongCnt >= 10) return { color: "dot-black", label: "기초 부족", styleClass: "st-black", textClass: "black" };
            return { color: "dot-red", label: "보완 필요", styleClass: "st-rose", textClass: "red" };
        }

        // 초기화
        document.getElementById('studentName').innerHTML = `${studentData.name}<span class="school-badge">${studentData.school}</span>`;
        document.getElementById('avatar').textContent = studentData.name[0];
        document.getElementById('commentBox').innerHTML = studentData.comment.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');

        // 상태창 생성
        const statusGrid = document.getElementById('statusGrid');
        
        const algStat = getNormalStatus(studentData.scores.algebra.score, studentData.scores.algebra.wrong);
        const calcStat = getNormalStatus(studentData.scores.calculus.score, studentData.scores.calculus.wrong);
        const mockStat = getMockStatus(studentData.scores.mock.wrong, studentData.scores.mock.score);

        const icons = {
            algebra: testMeta.algebra.icon,
            calculus: testMeta.calculus.icon,
            mock: testMeta.mock.icon
        };

        statusGrid.innerHTML = `
            <div class="status-item ${algStat.styleClass}">
                <div class="status-icon-wrap">${icons.algebra}</div>
                <span class="status-subject">대수</span>
                <div class="traffic-dot ${algStat.color}"></div>
                <span class="status-label">${algStat.label}</span>
            </div>
            <div class="status-item ${calcStat.styleClass}">
                <div class="status-icon-wrap">${icons.calculus}</div>
                <span class="status-subject">미적분</span>
                <div class="traffic-dot ${calcStat.color}"></div>
                <span class="status-label">${calcStat.label}</span>
            </div>
            <div class="status-item ${mockStat.styleClass}">
                <div class="status-icon-wrap">${icons.mock}</div>
                <span class="status-subject">담금질</span>
                <div class="traffic-dot ${mockStat.color}"></div>
                <span class="status-label">${mockStat.label}</span>
            </div>
        `;

        // 로그 생성
        document.getElementById('logContainer').innerHTML = studentData.logs.map(log => {
            const accentColor = log.type === 'calculus' ? 'var(--accent-violet)' : 'var(--accent-blue)';
            return `
            <div class="timeline-item">
                <div class="timeline-dot" style="background:${accentColor}; border-color:${accentColor}"></div>
                <div class="log-date" style="color:${accentColor};">${log.date}</div>
                <div class="log-title">${log.title}</div>
                <div class="log-desc">${log.desc}</div>
            </div>`;
        }).join('');

        // 시험 카드 생성
        const testContainer = document.getElementById('testContainer');
        ['algebra', 'calculus', 'mock'].forEach(key => {
            const data = studentData.scores[key];
            const meta = testMeta[key];
            const rank = studentData.ranks[key];
            const wrongs = studentData.incorrects[key]; 
            
            let colorClass;
            if (key === 'mock') colorClass = mockStat.textClass;
            else if (key === 'algebra') colorClass = algStat.textClass;
            else colorClass = calcStat.textClass;

            let iconColor = 'var(--accent-blue)';
            let iconBg = 'rgba(59, 130, 246, 0.1)';
            if(key === 'calculus') { iconColor = 'var(--accent-violet)'; iconBg = 'rgba(139, 92, 246, 0.1)'; }
            if(key === 'mock') { iconColor = 'var(--accent-rose)'; iconBg = 'rgba(244, 63, 94, 0.1)'; }

            let tags = Object.entries(wrongs).map(([qNum, status]) => {
                let tagClass = 'warning-tag';
                let text = `Q${qNum}`;
                
                if (status === 'C') { tagClass = 'check-tag'; text += ' (스스로 고침)'; }
                else if (status === 'D') { tagClass = 'review-tag'; text += ' (복습 필요)'; }
                else if (status === 'X') { tagClass = 'warning-tag'; text += ' (재학습)'; }
                else if (status === 'T') { text += ' (시간 부족)'; }
                
                return `<span class="tag ${tagClass}">${text}</span>`;
            }).join('');

            if (!tags) tags = '<span class="tag" style="color:#4ade80; border-color:rgba(74,222,128,0.3)">오답 없음</span>';

            const html = `
            <section class="card test-card ${colorClass}">
                <div class="test-top">
                    <div class="test-info-group">
                        <div class="test-name">
                            <div class="card-icon-box" style="width:24px; height:24px; background:${iconBg}; color:${iconColor}; margin-right:4px;">
                                ${meta.icon}
                            </div>
                            ${meta.title}
                        </div>
                        <span class="test-sub">${meta.sub}</span>
                        <span class="test-rank">${rank.rank}등 / ${rank.total}명</span>
                    </div>
                    <div class="test-score">${data.score}<span style="font-size:12px; font-weight:600; color:#64748b; margin-left:2px;">점</span></div>
                </div>
                <div style="border-top:1px solid rgba(255,255,255,0.05); padding-top:12px;">
                    <div class="tag-box">${tags}</div>
                    <button class="detail-btn" onclick="openModal('${key}')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                        문항별 상세 분석 보기
                    </button>
                </div>
            </section>`;
            testContainer.insertAdjacentHTML('beforeend', html);
        });

        // 계획
        document.getElementById('planContainer').innerHTML = studentData.plans.map(p => `
            <div class="plan-item" style="border-left-color: ${p.color}">
                <div class="plan-header">
                    <div class="plan-subj" style="color:${p.color}">${p.subj}</div>
                </div>
                <div class="plan-title">${p.title}</div>
                <div class="plan-desc">${p.desc}</div>
            </div>
        `).join('');

        // 차트
        function drawChart() {
            const canvas = document.getElementById('barCanvas');
            const ctx = canvas.getContext('2d');
            const w = canvas.width;
            const h = canvas.height;
            const pad = { b: 30, t: 20, l: 10, r: 10 };

            const chartData = [
                { label: '대수', val: studentData.scores.algebra.score || 0, color: '#3b82f6' },
                { label: '미적분', val: studentData.scores.calculus.score || 0, color: '#8b5cf6' },
                { label: '담금질', val: studentData.scores.mock.score || 0, color: '#f43f5e' }
            ];

            const barW = 50;
            const gap = (w - pad.l - pad.r - barW * 3) / 4;

            ctx.beginPath();
            ctx.moveTo(pad.l, h - pad.b);
            ctx.lineTo(w - pad.r, h - pad.b);
            ctx.strokeStyle = '#334155';
            ctx.stroke();

            chartData.forEach((d, i) => {
                const x = pad.l + gap + i * (barW + gap);
                const barH = (d.val / 100) * (h - pad.b - pad.t);
                const y = h - pad.b - barH;

                ctx.fillStyle = d.color;
                ctx.beginPath();
                ctx.roundRect(x, y, barW, barH, [6, 6, 0, 0]);
                ctx.fill();
                
                ctx.shadowColor = d.color;
                ctx.shadowBlur = 10;
                ctx.fill();
                ctx.shadowBlur = 0; 

                ctx.fillStyle = '#fff';
                ctx.font = 'bold 14px "Roboto Mono", sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(d.val, x + barW/2, y - 8);

                ctx.fillStyle = '#94a3b8';
                ctx.font = 'bold 12px "Noto Sans KR", sans-serif';
                ctx.fillText(d.label, x + barW/2, h - 8);
            });
        }
        window.onload = drawChart;

        // [모달]
        const modal = document.getElementById('detailModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalBody = document.getElementById('modalBody');

        function openModal(key) {
            const meta = testMeta[key];
            const details = detailData[key];
            const incorrects = studentData.incorrects[key];
            
            modalTitle.innerHTML = `<span style="color:${key==='algebra'?'var(--accent-blue)':(key==='calculus'?'var(--accent-violet)':'var(--accent-rose)')}">${meta.title}</span> 상세 분석`;
            
            let html = `<table class="detail-table"><thead><tr><th style="width:40px;">No.</th><th>핵심 개념</th><th>난이도</th><th style="width:60px;">결과</th></tr></thead><tbody>`;
            
            details.forEach(item => {
                const status = incorrects[item.q]; 
                let resHtml = `<span class="res-o">O</span>`;
                
                if (status === 'C') resHtml = `<span class="res-check">C</span>`; 
                else if (status === 'D') resHtml = `<span class="res-review">D</span>`; 
                else if (status === 'X') resHtml = `<span class="res-x">X</span>`;
                else if (status === 'T') resHtml = `<span class="res-time">T</span>`;

                let diffClass = '';
                if(item.diff === '하') diffClass = 'diff-low';
                else if(item.diff === '중') diffClass = 'diff-mid';
                else diffClass = 'diff-high';

                html += `<tr><td class="q-num">${item.q}</td><td>${item.concept}</td><td><span class="q-badge ${diffClass}">${item.diff}</span></td><td>${resHtml}</td></tr>`;
            });
            html += `</tbody></table>`;
            modalBody.innerHTML = html;
            modal.classList.add('active');
        }
        function closeModal() { modal.classList.remove('active'); }
        modal.addEventListener('click', (e) => { if(e.target === modal) closeModal(); });

    </script>
</body>
</html>